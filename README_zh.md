# UEXECUTER
语言: [中文](README_zh.md) | [英文](README.md)

UEXECUTER 是一个可爱的函数调用器，采用人类可读的字符串作为指令，通过串口通讯，对单片机上的函数进行调用。目前做了对 STM32F4 系列单片机的支持，支持 ARM 硬件浮点数模型（`-mfloat-abi=hard`）。

## 特性
- 人类可读的指令
- 支持 ARM 硬件浮点数模型
- 易于使用

## 用法
1. 定义你的服务并注册你的函数：
   ```cpp
   double add_f32_f64_i32(float x, double y, int32_t z)
   {
       return x + y + z;
   }
   double add_f32_f64(float x, double y)
   {
       return x + y;
   }
   UEXECUTER_DEFINE_SERVICE(my_uexecuter_service){
       // C-compatible way, provide result type and param types manually
       UEXECUTER_FUNCTION_PROTOTYPE(add_f32_f64_i32, "add_f32_f64_i32", UEXECUTER_CALLER_TYPE_F64,
                                    UEXECUTER_CALLER_TYPE_F32, UEXECUTER_CALLER_TYPE_F64, UEXECUTER_CALLER_TYPE_I32), 
       // C++ only, use AUTO to automatically detect prototype
       UEXECUTER_FUNCTION_PROTOTYPE_AUTO(add_f32_f64, "add_f32_f64"),
   };
   ```
2. 初始化 uexecuter 系统：
   ```cpp
   static uexecuter_t uexecuter;
   uexecuter_init(&uexecuter, my_uexecuter_service, UEXECUTER_SERVICE_N_FUNC(my_uexecuter_service));
   ```
3. 配置通信系统并将你的 uexecuter 绑定到通信系统上： 
   ```cpp
   static uexecuter_transport_stm32_t uexecuter_transport;
   uexecuter_transport_stm32_init(&uexecuter_transport, USART1);
   uexecuter_bind(&uexecuter, &uexecuter_transport.base);
   uexecuter_transport_stm32_begin(&uexecuter_transport);
   extern "C" void usart1_irq()
   {
       uexecuter_transport_stm32_handle_isr(&uexecuter_transport);
   }
   extern "C" void USART1_IRQHandler(void) // generated by STM32CubeMX, usually in stm32f4xx_it.c
   {
       return usart1_irq();
   }
   ```
4. 如果使用计时功能，请确保 SysTick 的中断优先级比 USART 的中断优先级高。

## 许可证
在 [MPL-2.0](./LICENSE) 许可证下许可使用